# 打印机日志自动导出与入库脚本

## 项目简介

本项目旨在自动化获取打印机后台的作业日志，并将其结构化地存入MySQL数据库，以便于后续的数据分析、成本核算和使用情况监控。

脚本通过 `Selenium` 模拟浏览器操作，自动登录到打印机的 web 管理界面，按天导出指定月份的作业历史报告（CSV格式），然后通过 `pandas` 进行数据清洗和处理，最终将干净、统一的数据批量写入到MySQL数据库中。

---

## 主要特性

- **智能数据处理**：
    - 自动检测并处理多种文件编码 (`gb18030`, `utf-8` 等)。
    - 自动清洗数据，如将空的页数/张数转换为 `0`。
- **高效数据库操作**：
    - 数据一次性批量写入，性能高效。
    - 利用数据库唯一键 (`UNIQUE KEY`) 约束，天生支持重复运行，不会产生重复数据。
- **模块化设计**：配置、数据库操作、数据处理、自动化脚本各司其职，代码结构清晰，易于维护和扩展。

---

## 项目结构

```
.
├── data_processor.py      # 核心数据处理模块，负责读取CSV、清洗数据并写入数据库
├── database_utils.py      # 数据库工具模块，封装了数据库连接、建表、插入等操作
├── db_config.py           # 数据库连接配置文件
├── floor2.py              # 2楼打印机的自动化主脚本（入口程序）
├── floor4.py              # 4楼打印机的自动化主脚本（入口程序）
├── README.md              # 项目说明文件
└── requirements.txt       # Python 依赖库列表
```






#### 2. 依赖

```txt
selenium
pandas
python-dateutil
PyMySQL
numpy
```




## 使用方法

脚本被设计为每月初自动运行，以下载上个月的完整报告。

直接在终端中运行主脚本即可



## 自动化调度 (使用 Cron)

通过设置一个 `cron` 定时任务，让脚本在每个月1号的凌晨自动运行。

1.  打开 cron 编辑器：
    ```bash
    crontab -e
    ```

2.  在文件末尾添加以下两行（请确保使用**绝对路径**）：

    ```crontab
    # 在每个月1号的凌晨2:00，运行floor2的脚本
    0 2 1 * * /usr/bin/python /path/to/your/project/floor2.py >> /path/to/your/project/cron.log 2>&1

    # 在每个月1号的凌晨2:05，运行floor4的脚本
    5 2 1 * * /usr/bin/python /path/to/your/project/floor4.py >> /path/to/your/project/cron.log 2>&1
    ```
    - `0 2 1 * *` 表示“每月1日的2点0分”。
    - `>> ... 2>&1` 会将所有的输出和错误信息追加到 `cron.log` 文件中，方便排查问题。

