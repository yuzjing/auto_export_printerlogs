# 打印机日志自动导出与入库脚本

## 项目简介

本项目旨在自动化获取打印机后台的作业日志，并将其结构化地存入MySQL数据库，以便于后续的数据分析、成本核算和使用情况监控。

脚本通过 `Selenium` 模拟浏览器操作，自动登录到打印机的 web 管理界面，按天导出指定月份的作业历史报告（CSV格式），然后通过 `pandas` 进行数据清洗和处理，最终将干净、统一的数据批量写入到MySQL数据库中。

---

## 主要特性

- **智能数据处理**：
    - 自动检测并处理多种文件编码 (`gb18030`, `utf-8` 等)。
    - 自动清洗数据，如将空的页数/张数转换为 `0`。
- **高效数据库操作**：
    - 数据一次性批量写入，性能高效。
    - 利用数据库唯一键 (`UNIQUE KEY`) 约束，天生支持重复运行，不会产生重复数据。
- **模块化设计**：配置、数据库操作、数据处理、自动化脚本各司其职，代码结构清晰，易于维护和扩展。

---

## 项目结构

```
.
├── data_processor.py      # 核心数据处理模块，负责读取CSV、清洗数据并写入数据库
├── database_utils.py      # 数据库工具模块，封装了数据库连接、建表、插入等操作
├── db_config.py           # 数据库连接配置文件
├── floor2.py              # 打印机一的自动化主脚本（入口程序）
├── floor4.py              # 打印机二的自动化主脚本（入口程序）
├── README.md              # 项目说明文件
└── requirements.txt       # Python 依赖库列表
```






#### 2. 依赖

```txt
selenium
pandas
python-dateutil
PyMySQL
numpy
```




## 使用方法

脚本被设计为每月初自动运行，以下载上个月的完整报告。

直接在终端中运行主脚本即可



## 自动化调度 (使用systemd.timer)

藉由systemd.timer强大的功能实现：每月的1，2，3号的 12：30   12：45   13：00   13：15各运行一次。
参见[floor2_exporter.timer](floor2_exporter.timer)
